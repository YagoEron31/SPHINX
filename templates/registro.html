<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
</head>
<body>
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="alert alert-{{ category }} alert-dismissible fade show m-3" role="alert">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <input id="usuario" type="text"></input>
    <input id="email" type="email"></input>
    <input id="senha" type="password"></input>
    <button onclick="registro()">Registrar</button>

    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <script>
        async function sha256(mensagem) {
            const encoder = new TextEncoder();
            const data = encoder.encode(mensagem);
            const hashBuffer = await crypto.subtle.digest('SHA-256', data);
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
            return hashHex;
        }


        async function registro() {
            let usuario = document.getElementById("usuario").value;
            let email = document.getElementById("email").value;
            let senha = document.getElementById("senha").value;
            let hash_senha = await sha256(senha);
            
            const response = await fetch("/registro", {
                method: "POST",
                headers: {"Content-Type": "application/json"},
                body: JSON.stringify({"usuario": usuario, 
                                      "email": email,
                                      "senha": hash_senha})
            });

            const data = await response.json();
            if (data.success) {
                window.location.href = data.url;
            } else {
                window.location.reload();
            }
        }
    </script>
</body>